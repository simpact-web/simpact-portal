<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Espace Client - Simpact</title>
    <script src="users.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        /* MÃŠME DESIGN QUE LE COMMERCIAL MAIS SIMPLIFIÃ‰ */
        :root { --primary: #8b5cf6; --bg: #f8fafc; --text: #1e293b; } /* Violet pour les clients */
        body { font-family: 'Outfit', sans-serif; background: var(--bg); color: var(--text); padding: 2rem; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 2rem; border-radius: 16px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        
        header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; border-bottom: 2px solid #e2e8f0; padding-bottom: 1rem; }
        .logout-btn { background: #fee2e2; color: #991b1b; border: none; padding: 5px 12px; border-radius: 6px; cursor: pointer; }

        h2 { color: var(--primary); margin-top: 0; }
        .form-group { margin-bottom: 1.5rem; }
        label { display: block; font-weight: 600; margin-bottom: 0.5rem; color: #475569; }
        select, input, textarea { width: 100%; padding: 12px; border: 1px solid #cbd5e1; border-radius: 8px; font-family: inherit; box-sizing: border-box; }
        
        .upload-zone { border: 2px dashed #cbd5e1; padding: 20px; text-align: center; border-radius: 8px; cursor: pointer; transition: 0.2s; background: #f1f5f9; }
        .upload-zone:hover { border-color: var(--primary); background: #f3f0ff; }

        .btn-order { background: var(--primary); color: white; width: 100%; padding: 15px; border: none; border-radius: 8px; font-size: 1.1rem; font-weight: bold; cursor: pointer; margin-top: 20px; }
        .btn-order:hover { background: #7c3aed; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h3>ðŸ‘‹ Bonjour <span id="client-name">--</span></h3>
            <button class="logout-btn" onclick="logout()">DÃ©connexion</button>
        </header>

        <h2>Nouvelle Commande</h2>
        
        <div class="form-group">
            <label>Type de produit</label>
            <select id="prod-type">
                <option>Flyers</option>
                <option>Cartes de visite</option>
                <option>DÃ©pliants</option>
                <option>Brochures</option>
            </select>
        </div>
        
        <div class="form-group">
            <label>QuantitÃ©</label>
            <input type="number" id="qty" placeholder="Ex: 1000">
        </div>

        <div class="form-group">
            <label>Description / Instructions</label>
            <textarea id="desc" rows="3" placeholder="Ex: Papier brillant, coins arrondis..."></textarea>
        </div>

        <div class="form-group">
            <label>Fichier d'impression (PDF)</label>
            <input type="file" id="file-upload" accept=".pdf,.ai,.zip">
            <p style="font-size:0.8rem; color:#64748b; margin-top:5px;">Pour les gros fichiers (+10Mo), envoyez un lien WeTransfer dans la description.</p>
        </div>
        
        <div class="form-group" style="text-align:center; margin: 30px 0;">
            <p style="margin-bottom:10px; font-weight:600;">Pas de fichier ? CrÃ©ez-le :</p>
            <a href="https://www.canva.com/" target="_blank" style="background:linear-gradient(45deg, #00c4cc, #7d2ae8); color:white; padding:10px 20px; text-decoration:none; border-radius:50px; font-weight:bold;">ðŸŽ¨ Ouvrir Canva</a>
        </div>

        <button class="btn-order" onclick="submitClientOrder()">ENVOYER LA COMMANDE</button>
    </div>

    <script>
        const user = checkAuth('client');
        if(user) document.getElementById('client-name').textContent = user.name;

        // LIEN SCRIPT GOOGLE (Le mÃªme que commercial)
        const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwgafAjdP97KC60fsc8DpNBUYgCbDlNY4T5rs5tQ28nwqkdGJ_ELdefEnSQ-g9DXmLw1g/exec";

        function submitClientOrder() {
            const prod = document.getElementById('prod-type').value;
            const qty = document.getElementById('qty').value;
            const desc = document.getElementById('desc').value;
            const file = document.getElementById('file-upload').files[0];
            
            if(!qty) return alert("Veuillez mettre une quantitÃ©.");

            const btn = document.querySelector('.btn-order');
            btn.textContent = "â³ Envoi en cours..."; btn.disabled = true;

            // Construction de la donnÃ©e
            const ref = "WEB-" + Date.now().toString().slice(-5);
            
            // NOTE : L'upload rÃ©el de fichier vers Drive demande une config complexe.
            // Ici on simule l'envoi de la commande texte.
            // Pour le fichier, le mieux dans une V1 est de demander un lien Wetransfer ou Drive si c'est lourd.
            
            const formData = new FormData();
            formData.append("Date", new Date().toLocaleString());
            formData.append("Ref", ref);
            formData.append("Client", user.name); // Nom du compte connectÃ©
            formData.append("Produit", prod);
            formData.append("QuantitÃ©", qty);
            formData.append("Prix HT", "A DEVISER"); // Le client ne fixe pas le prix
            formData.append("DÃ©tails", desc + (file ? " [Fichier joint: " + file.name + "]" : ""));
            formData.append("Commercial", "CLIENT WEB");

            fetch(GOOGLE_SCRIPT_URL, { method: 'POST', body: formData })
            .then(r => {
                alert("âœ… Commande envoyÃ©e ! Un commercial va valider votre dossier.");
                window.location.reload();
            })
            .catch(e => {
                alert("Erreur rÃ©seau.");
                btn.disabled = false;
            });
        }
    </script>
</body>
</html>
