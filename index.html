<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simpact - Portail Central</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;700&display=swap" rel="stylesheet">
    <script src="users.js"></script>
    <style>
        body { font-family: 'Outfit', sans-serif; background: #f8fafc; min-height: 100vh; display: flex; align-items: center; justify-content: center; margin: 0; }
        .container { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 2rem; width: 100%; max-width: 1200px; padding: 2rem; }
        .card { background: white; padding: 2rem; border-radius: 16px; text-align: center; cursor: pointer; transition: 0.3s; box-shadow: 0 4px 6px rgba(0,0,0,0.05); text-decoration: none; color: #1e293b; border: 1px solid #e2e8f0; position: relative; overflow: hidden; }
        .card:hover { transform: translateY(-8px); box-shadow: 0 20px 25px rgba(0,0,0,0.1); border-color: #2563eb; }
        .icon { font-size: 3rem; margin-bottom: 1rem; display: block; }
        h2 { margin: 0 0 0.5rem 0; color: #0f172a; font-size: 1.25rem; }
        p { color: #64748b; font-size: 0.9rem; }
        .badge-lock { position: absolute; top: 1rem; right: 1rem; background: #fee2e2; color: #991b1b; font-size: 0.7rem; padding: 0.3rem 0.8rem; border-radius: 20px; font-weight: bold; }
        
        /* Login Modal */
        #login-modal { display: none; position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:999; justify-content:center; align-items:center; }
        .login-box { background:white; padding:2rem; border-radius:12px; width:300px; text-align:center; }
        .login-box input { width:100%; padding:10px; margin:10px 0; border:1px solid #ddd; border-radius:6px; box-sizing:border-box; }
        .login-box button { width:100%; padding:10px; background:#2563eb; color:white; border:none; border-radius:6px; cursor:pointer; font-weight:bold; }
    </style>
</head>
<body>
    <div class="container">
        <a href="client.html" class="card">
            <span class="icon">üë§</span>
            <h2>Espace Client</h2>
            <p>Devis Rapide</p>
        </a>

        <div onclick="openLogin('commercial')" class="card">
            <span class="badge-lock">üîí</span>
            <span class="icon">üíº</span>
            <h2>Commercial</h2>
            <p>Devis & Validation</p>
        </div>

        <div onclick="openLogin('production')" class="card">
            <span class="badge-lock">üîí</span>
            <span class="icon">üè≠</span>
            <h2>Atelier / Prod</h2>
            <p>Liste de fabrication</p>
        </div>

        <div onclick="openLogin('compta')" class="card">
            <span class="badge-lock">üîí</span>
            <span class="icon">üí∂</span>
            <h2>Comptabilit√©</h2>
            <p>Facturation & Paiement</p>
        </div>

        <div onclick="openLogin('admin')" class="card" style="background: #f1f5f9; border-style: dashed;">
            <span class="badge-lock">üîí</span>
            <span class="icon">‚öôÔ∏è</span>
            <h2>Admin</h2>
            <p>Configuration</p>
        </div>
    </div>

    <div id="login-modal">
        <div class="login-box">
            <h3 id="login-title">Connexion</h3>
            <input type="text" id="user-login" placeholder="Identifiant">
            <input type="password" id="user-pass" placeholder="Mot de passe">
            <button onclick="performLogin()">Se connecter</button>
            <button onclick="document.getElementById('login-modal').style.display='none'" style="background:transparent; color:#666; margin-top:10px;">Annuler</button>
        </div>
    </div>

    <script>
        let targetRole = '';

        function openLogin(role) {
            // Si d√©j√† connect√© avec le bon r√¥le, on y va direct
            const currentUser = JSON.parse(localStorage.getItem('simpactUser'));
            if(currentUser && (currentUser.role === role || currentUser.role === 'admin')) {
                redirect(role);
                return;
            }

            targetRole = role;
            document.getElementById('login-title').textContent = "Acc√®s " + role.toUpperCase();
            document.getElementById('login-modal').style.display = 'flex';
        }

        function performLogin() {
            const l = document.getElementById('user-login').value;
            const p = document.getElementById('user-pass').value;
            const user = loginUser(l, p);

            if(user) {
                if(user.role === 'admin' || user.role === targetRole) {
                    redirect(targetRole);
                } else {
                    alert("Ce compte n'a pas acc√®s √† la section " + targetRole);
                }
            } else {
                alert("Identifiants incorrects");
            }
        }

        function redirect(role) {
            if(role === 'commercial') window.location.href = 'commercial.html';
            else if(role === 'production') window.location.href = 'production.html';
            else if(role === 'compta') window.location.href = 'compta.html';
            else if(role === 'admin') window.location.href = 'admin.html';
        }
    </script>
</body>
</html>
